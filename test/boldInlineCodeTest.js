/**
 * æµ‹è¯•ç²—ä½“æ–‡æœ¬ä¸­åŒ…å«å†…è”ä»£ç çš„ä¿®å¤æ•ˆæœ
 */

// æ¨¡æ‹Ÿ RichTextFormatter çš„ä¿®å¤æ–¹æ³•
function fixDuplicateBoldMarkers(text) {
    // åŒ¹é…è¿ç»­çš„ç²—ä½“èŠ‚ç‚¹ï¼Œæ’å…¥ç©ºæ ¼ï¼Œç¡®ä¿Obsidianæ­£å¸¸æ¸²æŸ“
    // ä¾‹å¦‚ï¼š**æ•°æ®æ ¼å¼ï¼š****`è·ç¦»,å½’ä¸€åŒ–å€¼`** -> **æ•°æ®æ ¼å¼ï¼š** **`è·ç¦»,å½’ä¸€åŒ–å€¼`**
    return text.replace(/\*\*([^*]+)\*\*(?=\*\*)/g, '**$1** ');
}

// æµ‹è¯•ç”¨ä¾‹
const testCases = [
    {
        name: "ç²—ä½“æ–‡æœ¬åŒ…å«å†…è”ä»£ç ï¼ˆç”¨ç©ºæ ¼åˆ†å¼€ï¼‰",
        input: "**æ•°æ®æ ¼å¼ï¼š****`è·ç¦»,å½’ä¸€åŒ–å€¼`**",
        expected: "**æ•°æ®æ ¼å¼ï¼š** **`è·ç¦»,å½’ä¸€åŒ–å€¼`**"
    },
    {
        name: "å¤šä¸ªå†…è”ä»£ç ï¼ˆç”¨ç©ºæ ¼åˆ†å¼€ï¼‰",
        input: "**æµ‹è¯•****`code1`****`code2`**",
        expected: "**æµ‹è¯•** **`code1`** **`code2`**"
    },
    {
        name: "æ­£å¸¸ç²—ä½“æ–‡æœ¬ï¼ˆä¸åº”è¢«ä¿®æ”¹ï¼‰",
        input: "**æ­£å¸¸ç²—ä½“æ–‡æœ¬**",
        expected: "**æ­£å¸¸ç²—ä½“æ–‡æœ¬**"
    },
    {
        name: "å†…è”ä»£ç ä¸åœ¨ç²—ä½“ä¸­ï¼ˆä¸åº”è¢«ä¿®æ”¹ï¼‰",
        input: "æ™®é€šæ–‡æœ¬`ä»£ç `æ™®é€šæ–‡æœ¬",
        expected: "æ™®é€šæ–‡æœ¬`ä»£ç `æ™®é€šæ–‡æœ¬"
    },
    {
        name: "å¤æ‚åœºæ™¯æµ‹è¯•",
        input: "**é…ç½®é¡¹ï¼š****`api_key`** å’Œ ****`secret`**",
        expected: "**é…ç½®é¡¹ï¼š** **`api_key`** å’Œ **`secret`**"
    }
];

console.log("ğŸ§ª å¼€å§‹æµ‹è¯•ç²—ä½“æ–‡æœ¬ä¸­åŒ…å«å†…è”ä»£ç çš„ä¿®å¤æ•ˆæœ...\n");

testCases.forEach((testCase, index) => {
    console.log(`ğŸ“‹ æµ‹è¯•ç”¨ä¾‹ ${index + 1}: ${testCase.name}`);
    console.log(`è¾“å…¥: "${testCase.input}"`);
    
    const result = fixDuplicateBoldMarkers(testCase.input);
    console.log(`è¾“å‡º: "${result}"`);
    console.log(`æœŸæœ›: "${testCase.expected}"`);
    
    const passed = result === testCase.expected;
    console.log(`ç»“æœ: ${passed ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`);
});

console.log("\nâœ… æµ‹è¯•å®Œæˆï¼"); 