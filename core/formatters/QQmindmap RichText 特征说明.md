# QQ文档思维导图 Richtext 格式分析指南

## 核心数据结构

QQ文档思维导图使用JSON格式存储数据，主要包含以下结构:

```json
{
  "type": 5,
  "data": {
    "id": "",
    "title": "节点标题",
    "collapse": false,
    "children": {
      "attached": [子节点数组]
    }
  }
}
```

## 节点属性规则

### 1. 基础属性
- **id**: 节点唯一标识符，可为空字符串- **title**: 节点显示文本内容，如"Work Plan"、"Category 1"等- **collapse**: 布尔值，控制节点展开/折叠状态### 2. 标记系统 (Markers)
节点支持多种视觉标记，用于表示不同的状态和类型:

```json
"markers": [{
  "markerId": "标记类型ID",
  "id": "",
  "color": "颜色值"
}]
```

**常见标记类型**：
- `symbol-group`: 分组标记，颜色为 `#f5c400`，用于标识部门等分组信息- `symbol-user`: 用户标记，颜色为 `#dd4097`，用于标识责任人- `task-8oct`: 任务完成标记，颜色为 `#45b076`，用于标识完成状态- `symbol-stopwatch`: 时间标记，颜色为 `#de3d36`，用于标识时间相关信息### 3. 标签系统 (Labels)
支持为节点添加特殊标签，特别用于代码块等特殊内容:

```json
"labels": [{
  "id": "qq-mind-map-code-block-label",
  "text": "code-block",
  "backgroundColor": "rgb(172, 226, 197)",
  "color": "#000000"
}]
```

### 4. 富文本内容 (Notes)
节点可包含HTML格式的富文本内容，支持复杂的代码块存储:

```json
"notes": {
  "content": "<p>HTML格式内容</p>"
}
```

**HTML标签规则**：
- 支持 `<p>`, `<br>`, `&nbsp;` 等基础HTML标签- 支持转义字符处理- 代码块使用特殊的HTML转义存储方式### 5. 位置信息
节点包含坐标位置信息，用于思维导图的布局:

```json
"position": {
  "x": -11.20001220703125,
  "y": -459.2
}
```

## 代码块存储机制

QQ文档对代码块采用特殊的存储方式:

### 1. 代码块节点标识
- **节点标题**: 使用代码块语法开头，如 `"title": "```${language}"`- **专用标签**: 添加 `code-block` 标签，背景色为淡绿色### 2. HTML转义规则
代码内容在 `notes.content` 中存储，采用严格的HTML转义:
- 换行使用 `<br>` 标签
- 空格转换为 `&nbsp;`
- 代码块包裹在 `<p>` 标签中
- 支持注释和代码结构的完整保存

## MD to Richtext 转换指南

### 转换规则建议
1. **标题映射**: Markdown标题层级转换为节点的嵌套 `children.attached` 结构2. **文本内容**: 普通文本转换为 `title` 属性或 `notes.content`3. **代码块处理**: 
   - 识别 Markdown 代码块语法
   - 创建带有 `code-block` 标签的节点- 进行适当的HTML转义处理4. **标记映射**: 将 Markdown 的特殊语法转换为相应的 markers### 转换风险与注意事项
1. **转义处理**: 特殊字符需要多重转义，避免冲突2. **层级结构**: 确保 Markdown 标题层级正确映射到思维导图结构3. **位置计算**: 需要为新节点分配合适的坐标位置4. **数据完整性**: 保证转换过程中不丢失原始信息## QQtoMD 反向转换指南

### 转换策略
1. **结构解析**: 通过 `children.attached` 重建 Markdown 标题层级2. **代码块识别**: 通过 `code-block` 标签识别代码节点3. **HTML反转义**: 将HTML格式还原为 Markdown 语法4. **标记处理**: 将 markers 转换为相应的 Markdown 语法或注释### 潜在问题
- 位置信息在 Markdown 中无法表示，转换时会丢失- 复杂的标记系统可能无法完全映射到 Markdown- HTML富文本的某些格式可能降级处理## 最佳实践建议

1. **测试驱动开发**: 建立全面的测试用例，涵盖各种节点类型和标记2. **错误恢复机制**: 实现转换失败时的降级处理3. **格式验证**: 转换后验证数据结构的完整性4. **用户反馈**: 提供转换预览功能，允许用户确认结果5. **版本兼容性**: 考虑QQ文档格式的版本变化，保持向后兼容