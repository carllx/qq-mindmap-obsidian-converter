<meta charset='utf-8'><html><head></head><body><div data-mind-map="[{&quot;type&quot;:5,&quot;data&quot;:{&quot;title&quot;:{&quot;children&quot;:[{&quot;type&quot;:&quot;paragraph&quot;,&quot;children&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;text&quot;:&quot;```cpp&quot;}]}],&quot;type&quot;:&quot;document&quot;},&quot;labels&quot;:[{&quot;id&quot;:&quot;qq-mind-map-code-block-label&quot;,&quot;text&quot;:&quot;code-block&quot;,&quot;backgroundColor&quot;:&quot;#F0F0F0&quot;,&quot;color&quot;:&quot;#000000&quot;}],&quot;notes&quot;:{&quot;content&quot;:&quot;&lt;p&gt;&lt;br&gt;```cpp&lt;br&gt;// Arduino超声波传感器代码&lt;br&gt;// 用于与TouchDesigner通信&lt;/p&gt;\n&lt;p&gt;const int trigPin = 2; &amp;nbsp; &amp;nbsp;// 触发引脚&lt;br&gt;const int echoPin = 3; &amp;nbsp; &amp;nbsp;// 回声引脚&lt;/p&gt;\n&lt;p&gt;long duration;&lt;br&gt;int distance;&lt;br&gt;int smoothDistance;&lt;br&gt;int lastDistance = 0;&lt;/p&gt;\n&lt;p&gt;void setup() {&lt;br&gt;&amp;nbsp; // 初始化串口通信&lt;br&gt;&amp;nbsp; Serial.begin(9600);&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; // 设置引脚模式&lt;br&gt;&amp;nbsp; pinMode(trigPin, OUTPUT);&lt;br&gt;&amp;nbsp; pinMode(echoPin, INPUT);&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; Serial.println(\&quot;Arduino Ultrasonic Sensor Ready\&quot;);&lt;br&gt;}&lt;/p&gt;\n&lt;p&gt;void loop() {&lt;br&gt;&amp;nbsp; // 清除触发引脚&lt;br&gt;&amp;nbsp; digitalWrite(trigPin, LOW);&lt;br&gt;&amp;nbsp; delayMicroseconds(2);&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; // 发送10微秒的高电平脉冲&lt;br&gt;&amp;nbsp; digitalWrite(trigPin, HIGH);&lt;br&gt;&amp;nbsp; delayMicroseconds(10);&lt;br&gt;&amp;nbsp; digitalWrite(trigPin, LOW);&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; // 读取回声引脚的脉冲持续时间&lt;br&gt;&amp;nbsp; duration = pulseIn(echoPin, HIGH);&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; // 计算距离（厘米）&lt;br&gt;&amp;nbsp; distance = duration * 0.034 / 2;&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; // 简单的平滑滤波&lt;br&gt;&amp;nbsp; smoothDistance = (distance + lastDistance) / 2;&lt;br&gt;&amp;nbsp; lastDistance = smoothDistance;&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; // 限制距离范围（0-200cm）&lt;br&gt;&amp;nbsp; if (smoothDistance &amp;gt; 200) {&lt;br&gt;&amp;nbsp; &amp;nbsp; smoothDistance = 200;&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;nbsp; if (smoothDistance &amp;lt; 0) {&lt;br&gt;&amp;nbsp; &amp;nbsp; smoothDistance = 0;&lt;br&gt;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; // 发送数据到TouchDesigner&lt;br&gt;&amp;nbsp; // 格式：distance,normalized_value&lt;br&gt;&amp;nbsp; float normalizedValue = smoothDistance / 200.0; // 归一化到0-1&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; Serial.print(smoothDistance);&lt;br&gt;&amp;nbsp; Serial.print(\&quot;,\&quot;);&lt;br&gt;&amp;nbsp; Serial.println(normalizedValue, 3);&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp; // 延迟以控制数据发送频率&lt;br&gt;&amp;nbsp; delay(50); // 20Hz更新频率&lt;br&gt;}&lt;/p&gt;\n&lt;p&gt;```&lt;/p&gt;&quot;},&quot;id&quot;:&quot;&quot;}}]"><div><div style="white-space: pre;">```cpp</div></div></div></body></html>