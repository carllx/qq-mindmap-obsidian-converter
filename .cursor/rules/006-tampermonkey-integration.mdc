---
description: |è§„èŒƒ Tampermonkey ç”¨æˆ·è„šæœ¬é›†æˆå¼€å‘ï¼ŒåŒ…æ‹¬ CDN ä¾èµ–ç®¡ç†ã€æµè§ˆå™¨ç¯å¢ƒé€‚é…ã€æ¨¡å—ç³»ç»Ÿã€UI ç»„ä»¶å¼€å‘ã€é€šçŸ¥ç³»ç»Ÿã€å®‰å…¨è€ƒè™‘ç­‰å…³é”®æ–¹é¢ã€‚
alwaysApply: false
---

# Tampermonkey é›†æˆ

## ğŸ¯ ç”¨æˆ·è„šæœ¬ç‰¹æ€§

### CDN ä¾èµ–ç®¡ç†
- **å¤–éƒ¨ä¾èµ–**ï¼šé€šè¿‡ `@require` åŠ è½½ CDN èµ„æº
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæŒ‡å®šä¾èµ–çš„ç²¾ç¡®ç‰ˆæœ¬
- **åŠ è½½é¡ºåº**ï¼šç¡®ä¿ä¾èµ–æŒ‰æ­£ç¡®é¡ºåºåŠ è½½
- **é”™è¯¯å¤„ç†**ï¼šå¤„ç†ä¾èµ–åŠ è½½å¤±è´¥çš„æƒ…å†µ

### æµè§ˆå™¨ç¯å¢ƒé€‚é…
```javascript
// ç”¨æˆ·è„šæœ¬å¤´éƒ¨é…ç½®
// ==UserScript==
// @name         QQ Mind Map to Obsidian Converter
// @namespace    http://tampermonkey.net/
// @version      2.0.0
// @description  Converts QQ Mind Map to Obsidian Markdown and vice-versa
// @author       carllx & Gemini
// @match        https://docs.qq.com/mind/*
// @grant        GM_setClipboard
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @require      https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js
// @require      https://cdn.jsdelivr.net/npm/dompurify@3.1.5/dist/purify.min.js
// ==/UserScript==
```

## ğŸ”§ æ¨¡å—ç³»ç»Ÿ

### ç®€åŒ–çš„æ¨¡å—å®šä¹‰
```javascript
// ç«‹å³åˆ›å»ºå…¨å±€å¯¹è±¡
window.QQMindMap2Obsidian = {
    test: true,
    version: 'simple',
    status: 'initializing'
};

// ç®€åŒ–çš„æ¨¡å—ç³»ç»Ÿ
const modules = {};
function define(name, factory) { 
    try {
        modules[name] = factory();
        console.log('âœ… Module loaded:', name);
    } catch (error) {
        console.error('âŒ Error loading module:', name, error);
    }
}
function require(name) { 
    const module = modules[name];
    if (!module) {
        console.error('âŒ Module not found:', name);
    }
    return module;
}
```

### æ¨¡å—åŠ è½½ç­–ç•¥
- **å»¶è¿ŸåŠ è½½**ï¼šæŒ‰éœ€åŠ è½½æ¨¡å—
- **é”™è¯¯æ¢å¤**ï¼šå¤„ç†æ¨¡å—åŠ è½½å¤±è´¥
- **ä¾èµ–è§£æ**ï¼šè‡ªåŠ¨è§£ææ¨¡å—ä¾èµ–
- **ç¼“å­˜æœºåˆ¶**ï¼šé¿å…é‡å¤åŠ è½½

## ğŸ¨ UI ç»„ä»¶å¼€å‘

### ç”¨æˆ·ç•Œé¢åŸåˆ™
- **éä¾µå…¥æ€§**ï¼šä¸å¹²æ‰°åŸæœ‰é¡µé¢åŠŸèƒ½
- **å“åº”å¼è®¾è®¡**ï¼šé€‚åº”ä¸åŒå±å¹•å°ºå¯¸
- **ç”¨æˆ·å‹å¥½**ï¼šæä¾›æ¸…æ™°çš„äº¤äº’åé¦ˆ
- **å¯è®¿é—®æ€§**ï¼šæ”¯æŒé”®ç›˜å¯¼èˆªå’Œå±å¹•é˜…è¯»å™¨

### UI ç»„ä»¶ç¤ºä¾‹
```javascript
// åˆ›å»ºç”¨æˆ·ç•Œé¢
function createUI(parentElement) {
    const container = document.createElement('div');
    container.className = 'qq-converter-ui';
    container.innerHTML = `
        <div class="converter-header">
            <h3>QQ Mind Map Converter</h3>
        </div>
        <div class="converter-controls">
            <button id="qq-to-md" class="btn btn-primary">QQ â†’ MD</button>
            <button id="md-to-qq" class="btn btn-secondary">MD â†’ QQ</button>
        </div>
        <div class="converter-status" id="status"></div>
    `;
    
    parentElement.appendChild(container);
    return container;
}
```

### æ ·å¼ç®¡ç†
```javascript
// æ·»åŠ æ ·å¼
function addStyles() {
    const style = document.createElement('style');
    style.textContent = `
        .qq-converter-ui {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 4px;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
    `;
    document.head.appendChild(style);
}
```

## ğŸ“‹ é€šçŸ¥ç³»ç»Ÿ

### ç”¨æˆ·åé¦ˆæœºåˆ¶
```javascript
// é€šçŸ¥ç³»ç»Ÿ
class NotificationSystem {
    constructor() {
        this.defaultDuration = 3000;
        this.notifications = [];
    }
    
    show(message, type = 'success', duration = this.defaultDuration) {
        const notification = this.createNotification(message, type);
        document.body.appendChild(notification);
        
        this.animateIn(notification);
        
        setTimeout(() => {
            this.animateOut(notification);
        }, duration);
    }
    
    success(message, duration = this.defaultDuration) {
        this.show(message, 'success', duration);
    }
    
    error(message, duration = this.defaultDuration) {
        this.show(message, 'error', duration);
    }
    
    warning(message, duration = this.defaultDuration) {
        this.show(message, 'warning', duration);
    }
    
    info(message, duration = this.defaultDuration) {
        this.show(message, 'info', duration);
    }
}
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### å†…å®¹å®‰å…¨ç­–ç•¥
- **DOMPurify é›†æˆ**ï¼šæ¸…ç†ç”¨æˆ·è¾“å…¥å’Œè¾“å‡º
- **XSS é˜²æŠ¤**ï¼šé˜²æ­¢è·¨ç«™è„šæœ¬æ”»å‡»
- **æ•°æ®éªŒè¯**ï¼šéªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥
- **å®‰å…¨å­˜å‚¨**ï¼šå®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·è®¾ç½®

### æƒé™ç®¡ç†
```javascript
// æƒé™æ£€æŸ¥
function checkPermissions() {
    const requiredGrants = [
        'GM_setClipboard',
        'GM_addStyle',
        'GM_setValue',
        'GM_getValue'
    ];
    
    const missingGrants = requiredGrants.filter(grant => 
        typeof window[grant] === 'undefined'
    );
    
    if (missingGrants.length > 0) {
        console.error('Missing required grants:', missingGrants);
        return false;
    }
    
    return true;
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### èµ„æºåŠ è½½ä¼˜åŒ–
- **å¼‚æ­¥åŠ è½½**ï¼šå¼‚æ­¥åŠ è½½éå…³é”®èµ„æº
- **ç¼“å­˜ç­–ç•¥**ï¼šå®ç°é€‚å½“çš„ç¼“å­˜æœºåˆ¶
- **ä»£ç åˆ†å‰²**ï¼šæŒ‰éœ€åŠ è½½åŠŸèƒ½æ¨¡å—
- **å†…å­˜ç®¡ç†**ï¼šåŠæ—¶æ¸…ç†ä¸éœ€è¦çš„èµ„æº

### é”™è¯¯å¤„ç†
```javascript
// å…¨å±€é”™è¯¯å¤„ç†
window.addEventListener('error', (event) => {
    console.error('Global error:', event.error);
    
    // å‘é€é”™è¯¯æŠ¥å‘Š
    if (window.QQMindMap2Obsidian && window.QQMindMap2Obsidian.notifications) {
        window.QQMindMap2Obsidian.notifications.error(
            'å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯'
        );
    }
});

// æœªå¤„ç†çš„ Promise æ‹’ç»
window.addEventListener('unhandledrejection', (event) => {
    console.error('Unhandled promise rejection:', event.reason);
});
```

## ğŸ“š æœ€ä½³å®è·µ

### å¼€å‘æµç¨‹
1. **æœ¬åœ°æµ‹è¯•**ï¼šåœ¨æœ¬åœ°ç¯å¢ƒæµ‹è¯•åŠŸèƒ½
2. **æµè§ˆå™¨æµ‹è¯•**ï¼šåœ¨ç›®æ ‡æµè§ˆå™¨ä¸­æµ‹è¯•
3. **ç”¨æˆ·åé¦ˆ**ï¼šæ”¶é›†ç”¨æˆ·åé¦ˆå¹¶è¿­ä»£
4. **ç‰ˆæœ¬ç®¡ç†**ï¼šä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶

### è°ƒè¯•æŠ€å·§
- **æ§åˆ¶å°æ—¥å¿—**ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„æ—¥å¿—æ¶ˆæ¯
- **é”™è¯¯è¾¹ç•Œ**ï¼šå®ç°é”™è¯¯è¾¹ç•Œå¤„ç†
- **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§è„šæœ¬æ€§èƒ½
- **ç”¨æˆ·åé¦ˆ**ï¼šæä¾›ç”¨æˆ·åé¦ˆæ¸ é“
description:
globs:
alwaysApply: false
---
